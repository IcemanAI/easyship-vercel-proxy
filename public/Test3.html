<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sendcloud Shipping Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    section { margin-bottom: 2rem; }
    pre { background: #eee; padding: 10px; overflow-x: auto; }
    label { display: block; margin-top: 10px; }
    input[type="number"] { width: 100px; }
  </style>
</head>
<body>
  <h1>Sendcloud Integration Test</h1>

  <!-- Toggle -->
  <section>
    <label><input type="checkbox" id="sandboxToggle" checked /> Use Sandbox Mode</label>
  </section>

  <!-- Basket -->
  <section>
    <h2>1. Get Delivery Estimate</h2>
    <label>
      Postal Code: <input id="postalCode" placeholder="e.g. 10001" />
    </label>
    <label>
      Country:
      <select id="country">
        <option value="US">United States</option>
        <option value="GB">United Kingdom</option>
        <option value="FR">France</option>
        <option value="NL">Netherlands</option>
        <option value="DE">Germany</option>
        <option value="BE">Belgium</option>
        <option value="ES">Spain</option>
        <option value="IT">Italy</option>
        <option value="IE">Ireland</option>
        <option value="CA">Canada</option>
        <option value="AU">Australia</option>
      </select>
    </label>
    <label>Weight (grams): <input type="number" id="weight" value="500" /></label>
    <label>Length (cm): <input type="number" id="length" value="10" /></label>
    <label>Width (cm): <input type="number" id="width" value="10" /></label>
    <label>Height (cm): <input type="number" id="height" value="5" /></label>

    <button onclick="getEstimate()">Get Estimate</button>
    <pre id="estimateOutput">Estimate will appear here...</pre>
  </section>

  <!-- Shipping Options (mock for now) -->
  <section>
    <h2>2. Show Shipping Options</h2>
    <button onclick="loadOptions()">Load Shipping Options</button>
    <div id="optionsContainer"></div>
    <button onclick="selectOption()">Select Option</button>
    <pre id="stripeOutput">Stripe total will be adjusted here...</pre>
  </section>

  <!-- Mock Checkout -->
  <section>
    <h2>3. Simulate Checkout Success</h2>
    <button onclick="completeOrder()">Complete Order</button>
    <pre id="hubspotOutput">Nothing stored yet...</pre>
  </section>

  <!-- Dev Logs -->
  <section>
    <h2>üõ† Dev Logs</h2>
    <pre id="logBox">Waiting for actions...</pre>
  </section>

  <script>
    const log = (msg) => {
      const box = document.getElementById('logBox');
      box.textContent += '\n\n' + msg;
    };

    const getEndpoint = () => {
      return "https://easyship-vercel-proxy.vercel.app/api/sendcloud-estimate";
    };

    async function getEstimate() {
      const postal_code = document.getElementById("postalCode").value.trim();
      const country = document.getElementById("country").value;
      const sandbox = document.getElementById("sandboxToggle").checked;
      const weight = parseInt(document.getElementById("weight").value, 10);
      const length = parseInt(document.getElementById("length").value, 10);
      const width = parseInt(document.getElementById("width").value, 10);
      const height = parseInt(document.getElementById("height").value, 10);

      if (!postal_code || !country) {
        alert("Please enter a postal code and select a country.");
        return;
      }

      const payload = {
        postal_code,
        country,
        weight,
        length,
        width,
        height,
        sandbox
      };

      document.getElementById("estimateOutput").textContent = "‚è≥ Getting estimate...";
      log("üì§ Sending:\n" + JSON.stringify(payload, null, 2));

      try {
        const res = await fetch(getEndpoint(), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        log(`üì¶ Response:\n${JSON.stringify(data, null, 2)}`);

        if (data.success && data.available_methods?.length > 0) {
          document.getElementById("estimateOutput").textContent =
            data.available_methods.map(m => `${m.name} ‚Äì ${m.min_weight}g‚Äì${m.max_weight}g`).join("\n");
        } else {
          document.getElementById("estimateOutput").textContent = "‚ùå No shipping methods returned.";
        }
      } catch (err) {
        console.error("‚ùå Fetch error:", err);
        document.getElementById("estimateOutput").textContent = "‚ùå Error fetching estimate.";
        log("‚ùå " + err.message);
      }
    }

    // (Leave your mock option / complete order code untouched for now)
    // ...
  </script>
</body>
</html>
